# Max turns limit scenario - loop exits when iteration limit reached
name: max_turns_limit_reached
description: Loop exits when iter.iteration reaches inputs.max_turns
inputs:
  mode: "auto"
  max_turns: 2
events:
  # Iteration 1: LLM requests a tool
  - node: agent_loop.call_llm
    output:
      message:
        role: assistant
        text: "Let me search for files."
      response_text: "Let me search for files."
      tool_calls:
        - id: call_0
          name: grep
          input:
            pattern: "TODO"
            path: "."
  - node: agent_loop.execute_tools
    output:
      message:
        role: tool
        text: ""
      tool_results:
        - tool_call_id: call_0
          content: '["main.go:10", "util.go:25"]'
      total_result_chars: 30
      thread_token_count: 500
  # Iteration 2 (max_turns=2, so this is the last allowed iteration)
  - node: agent_loop.call_llm
    output:
      message:
        role: assistant
        text: "Found some TODOs. Let me check the first file."
      response_text: "Found some TODOs. Let me check the first file."
      tool_calls:
        - id: call_1
          name: view
          input:
            file_path: "main.go"
  - node: agent_loop.execute_tools
    output:
      message:
        role: tool
        text: ""
      tool_results:
        - tool_call_id: call_1
          content: "// TODO: implement this"
      total_result_chars: 25
      thread_token_count: 600
  # Loop exits after iteration 2 because iter.iteration (2) is no longer < max_turns (2)
expect:
  outcome: completed
  reached:
    - agent_loop
    - agent_loop.call_llm
    - agent_loop.execute_tools
    - agent_loop.save_tool_results
  not_reached:
    - agent_loop.approval
    - agent_loop.filter_results
