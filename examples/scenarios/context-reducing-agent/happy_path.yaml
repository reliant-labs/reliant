# Happy Path: Small tool results saved directly
#
# Tests the simple path without context reduction:
# 1. LLM calls tools
# 2. Tool results are small (< 4000 chars)
# 3. Results are saved directly via save_tool_results
# 4. LLM responds without tools, loop exits
#
# This verifies the normal path works when no filtering is needed.

name: happy_path
description: Small tool results are saved directly without filtering

inputs:
  mode: "auto"

events:
  # Iteration 1: LLM calls a tool
  - node: agent_loop.call_llm
    type: llm_response
    text: "Let me check the file."
    tool_calls:
      - name: view
        input:
          file_path: "/project/main.go"

  # Small tool result (under 4000 chars)
  - node: agent_loop.execute_tools
    type: tool_result
    tool: view
    output:
      result: "package main\n\nimport \"fmt\"\n\nfunc main() {\n\tfmt.Println(\"Hello, World!\")\n}"
      total_result_chars: 80  # Well under 4000 threshold

  # Iteration 2: LLM responds without tools
  - node: agent_loop.call_llm
    type: llm_response
    text: "The main.go file contains a simple Hello World program."

expect:
  outcome: completed
  reached:
    - agent_loop
    - agent_loop.call_llm
    - agent_loop.execute_tools
    - agent_loop.save_tool_results  # Direct save path for small results
  not_reached:
    # Large result filtering not needed
    - agent_loop.filter_results
    - agent_loop.execute_filter
    - agent_loop.save_filtered_results
    # No approval in auto mode
    - agent_loop.approval
    # No compaction (context not that large)
    - agent_loop.compact
