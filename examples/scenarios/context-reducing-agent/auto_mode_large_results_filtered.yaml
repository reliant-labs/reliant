# Auto mode with large tool results - triggers filtering
name: auto_mode_large_results_filtered
description: Auto mode with large results triggers filter path
inputs:
  mode: "auto"
events:
  # First iteration: LLM requests a tool
  - node: agent_loop.call_llm
    output:
      message:
        role: assistant
        text: "Let me search the codebase."
      response_text: "Let me search the codebase."
      tool_calls:
        - id: call_0
          name: grep
          input:
            pattern: "import"
            path: "."
  # Tool returns large result (> 4000 chars)
  - node: agent_loop.execute_tools
    output:
      message:
        role: tool
        text: ""
      tool_results:
        - tool_call_id: call_0
          content: "lots of results here..."
      total_result_chars: 5000
      thread_token_count: 500
  # filter_results LLM call
  - node: agent_loop.filter_results
    output:
      message:
        role: assistant
        text: ""
      response_text: ""
      tool_calls:
        - id: call_1
          name: filtered_results
          input:
            results:
              - tool_call_id: "call_0"
                name: "grep"
                filtered: true
                content: "Summarized: 50 import statements found"
                is_error: false
  # execute_filter result
  - node: agent_loop.execute_filter
    output:
      message:
        role: tool
        text: ""
      tool_results:
        - tool_call_id: call_1
          content: '{"results": [{"tool_call_id": "call_0", "filtered": true, "content": "Summarized: 50 import statements found"}]}'
      response_data:
        filtered_results:
          results:
            - tool_call_id: "call_0"
              name: "grep"
              filtered: true
              content: "Summarized: 50 import statements found"
              is_error: false
      thread_token_count: 600
  # Second iteration: final response
  - node: agent_loop.call_llm
    output:
      message:
        role: assistant
        text: "Found 50 import statements across the codebase."
      response_text: "Found 50 import statements across the codebase."
      tool_calls: []
expect:
  outcome: completed
  reached:
    - agent_loop
    - agent_loop.call_llm
    - agent_loop.execute_tools
    - agent_loop.filter_results
    - agent_loop.execute_filter
    - agent_loop.save_filtered_results
  not_reached:
    - agent_loop.approval
    - agent_loop.save_tool_results
