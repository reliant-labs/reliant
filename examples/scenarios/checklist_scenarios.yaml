# Test scenarios for checklist.yaml workflow
#
# Checklist workflow structure (linear):
# - Planning phase: research → plan → criticize → revise → approve
# - Implementation phase: write_tests → implement → lint/test/build (parallel) → join_checks
# - Review phase: code_review → complete
#
# The workflow ends early if approval is denied.
#
# Steps enum: research, plan, critique, approve, tdd, implement, lint, test, build, code_review
#
# NOTE: Only provide events for nodes that will actually execute based on inputs.steps.

---
# Default steps - minimal workflow
name: default_steps_minimal
description: Default steps (research, plan, implement) - simplest workflow path.

# Default inputs: steps: [research, plan, implement]

events:
  - node: research
    output:
      response_text: "Research findings..."

  - node: plan
    output:
      response_text: "Here is the plan..."

  - node: implement
    output:
      response_text: "Implementation complete."

expect:
  outcome: completed
  reached:
    - research
    - plan
    - implement
    - complete

---
# All steps enabled, review passes
name: full_pipeline_review_passes
description: All steps run, review passes with structured output.

inputs:
  steps: [research, plan, critique, implement, code_review]

events:
  - node: research
    output:
      response_text: "Research findings..."

  - node: plan
    output:
      response_text: "The plan is..."

  - node: criticize
    output:
      response_text: "Critique: looks good overall."

  - node: revise
    output:
      response_text: "Revised approach..."

  - node: implement
    output:
      response_text: "Implementation done."

  - node: code_review
    output:
      response:
        grade: pass
        summary: "Code looks good, well structured."
        suggestions:
          - "Consider adding more comments"
          - "Could extract helper function"

expect:
  outcome: completed
  reached:
    - research
    - plan
    - criticize
    - revise
    - implement
    - code_review
    - complete

---
# Code review fails
name: code_review_fails
description: Code review returns fail grade with suggestions.

inputs:
  steps: [plan, implement, code_review]

events:
  - node: plan
    output:
      response_text: "Plan."

  - node: implement
    output:
      response_text: "Implementation."

  - node: code_review
    output:
      response:
        grade: fail
        summary: "Implementation has critical issues that need addressing."
        suggestions:
          - "Fix the null pointer exception in line 42"
          - "Add error handling for edge cases"
          - "Missing unit tests for new functionality"

expect:
  outcome: completed
  reached:
    - plan
    - implement
    - code_review
    - complete

---
# Code review with no suggestions
name: code_review_no_suggestions
description: Code review passes with no suggestions (empty array).

inputs:
  steps: [plan, implement, code_review]

events:
  - node: plan
    output:
      response_text: "Plan."

  - node: implement
    output:
      response_text: "Perfect implementation."

  - node: code_review
    output:
      response:
        grade: pass
        summary: "Excellent implementation, nothing to improve."
        suggestions: []

expect:
  outcome: completed
  reached:
    - plan
    - implement
    - code_review
    - complete

---
# Approval denied ends workflow
name: approval_denied_ends_workflow
description: When approval is denied, workflow ends without implementing.

inputs:
  steps: [plan, approve, implement, code_review]

events:
  - node: plan
    output:
      response_text: "Here's the plan."

  - node: approve
    output:
      status: denied

expect:
  outcome: completed
  reached:
    - plan
    - approve
  not_reached:
    - implement
    - code_review
    - complete

---
# Approval granted continues
name: approval_granted_continues
description: When approval is granted, workflow continues to implementation.

inputs:
  steps: [plan, approve, implement, code_review]

events:
  - node: plan
    output:
      response_text: "Here's the plan."

  - node: approve
    output:
      status: approved

  - node: implement
    output:
      response_text: "Implementation done."

  - node: code_review
    output:
      response:
        grade: pass
        summary: "Looks good."
        suggestions: []

expect:
  outcome: completed
  reached:
    - plan
    - approve
    - implement
    - code_review
    - complete

---
# TDD mode - write_tests runs before implement
name: tdd_mode_write_tests_first
description: TDD mode writes tests before implementation.

inputs:
  steps: [plan, tdd, implement, test, code_review]

events:
  - node: plan
    output:
      response_text: "Plan with TDD approach."

  - node: write_tests
    output:
      response_text: "Created failing tests for the new feature."

  - node: implement
    output:
      response_text: "Implemented the feature to make tests pass."

  - node: test
    output:
      exit_code: 0
      stdout: "All tests passed"

  - node: code_review
    output:
      response:
        grade: pass
        summary: "TDD approach resulted in well-tested code."
        suggestions:
          - "Consider adding integration tests"

expect:
  outcome: completed
  reached:
    - plan
    - write_tests
    - implement
    - test
    - code_review
    - complete

---
# All checks pass
name: all_checks_pass
description: Lint, test, and build all pass.

inputs:
  steps: [plan, implement, lint, test, build, code_review]

events:
  - node: plan
    output:
      response_text: "Plan."

  - node: implement
    output:
      response_text: "Implementation."

  - node: lint
    output:
      exit_code: 0
      stdout: "Lint passed"

  - node: test
    output:
      exit_code: 0
      stdout: "Tests passed"

  - node: build
    output:
      exit_code: 0
      stdout: "Build succeeded"

  - node: code_review
    output:
      response:
        grade: pass
        summary: "All checks passed, excellent implementation."
        suggestions: []

expect:
  outcome: completed
  reached:
    - plan
    - implement
    - lint
    - test
    - build
    - join_checks
    - code_review
    - complete

---
# Checks fail - code review sees failures
name: checks_fail_review_sees_failures
description: Failed checks are visible in code_review context.

inputs:
  steps: [plan, implement, lint, test, code_review]

events:
  - node: plan
    output:
      response_text: "Plan."

  - node: implement
    output:
      response_text: "Implementation."

  - node: lint
    output:
      exit_code: 0
      stdout: "Lint passed"

  - node: test
    output:
      exit_code: 1
      stdout: "Tests failed: 3 assertions failed"

  - node: code_review
    output:
      response:
        grade: fail
        summary: "Tests are failing, implementation incomplete."
        suggestions:
          - "Fix the failing test assertions"
          - "Check edge case handling"

expect:
  outcome: completed
  reached:
    - plan
    - implement
    - lint
    - test
    - code_review
    - complete

---
# Implement only - minimal workflow
name: implement_only_minimal
description: Only 'implement' step enabled - absolute minimal workflow.

inputs:
  steps: [implement]

events:
  - node: implement
    output:
      response_text: "Minimal implementation complete."

expect:
  outcome: completed
  reached:
    - implement
    - complete

---
# Planning only - no implementation
name: planning_only_no_implement
description: Only planning steps - research, plan, critique. No implementation.

inputs:
  steps: [research, plan, critique]

events:
  - node: research
    output:
      response_text: "Research complete."

  - node: plan
    output:
      response_text: "Plan complete."

  - node: criticize
    output:
      response_text: "Critique complete."

  - node: revise
    output:
      response_text: "Revise complete."

expect:
  outcome: completed
  reached:
    - research
    - plan
    - criticize
    - revise
    - complete

---
# Build only - no lint or test
name: build_only_no_lint_test
description: Build can run independently without lint or test.

inputs:
  steps: [plan, implement, build, code_review]

events:
  - node: plan
    output:
      response_text: "Plan for build."

  - node: implement
    output:
      response_text: "Implementation."

  - node: build
    output:
      exit_code: 0
      stdout: "Build succeeded"

  - node: code_review
    output:
      response:
        grade: pass
        summary: "Build passed."
        suggestions: []

expect:
  outcome: completed
  reached:
    - plan
    - implement
    - build
    - code_review
    - complete

---
# Lint only check
name: lint_only_check
description: Implementation with only lint check enabled.

inputs:
  steps: [plan, implement, lint]

events:
  - node: plan
    output:
      response_text: "Plan."

  - node: implement
    output:
      response_text: "Implementation."

  - node: lint
    output:
      exit_code: 0
      stdout: "Lint passed"

expect:
  outcome: completed
  reached:
    - plan
    - implement
    - lint
    - complete

---
# Code review without checks
name: code_review_without_checks
description: Code review can run without lint/test/build checks.

inputs:
  steps: [plan, implement, code_review]

events:
  - node: plan
    output:
      response_text: "Plan."

  - node: implement
    output:
      response_text: "Implementation without checks."

  - node: code_review
    output:
      response:
        grade: pass
        summary: "Reviewed without automated checks."
        suggestions:
          - "Consider adding CI checks in the future"

expect:
  outcome: completed
  reached:
    - plan
    - implement
    - code_review
    - complete

---
# All steps enabled - comprehensive
name: all_steps_enabled_comprehensive
description: Workflow with ALL steps enabled - full checklist flow.

inputs:
  steps: [research, plan, critique, approve, tdd, implement, lint, test, build, code_review]

events:
  - node: research
    output:
      response_text: "Research complete."

  - node: plan
    output:
      response_text: "Plan complete."

  - node: criticize
    output:
      response_text: "Critique complete."

  - node: revise
    output:
      response_text: "Revise complete."

  - node: approve
    output:
      status: approved

  - node: write_tests
    output:
      response_text: "Tests written."

  - node: implement
    output:
      response_text: "Implementation complete."

  - node: lint
    output:
      exit_code: 0
      stdout: "Lint passed"

  - node: test
    output:
      exit_code: 0
      stdout: "Tests passed"

  - node: build
    output:
      exit_code: 0
      stdout: "Build passed"

  - node: code_review
    output:
      response:
        grade: pass
        summary: "Perfect implementation with comprehensive testing."
        suggestions: []

expect:
  outcome: completed
  reached:
    - research
    - plan
    - criticize
    - revise
    - approve
    - write_tests
    - implement
    - lint
    - test
    - build
    - join_checks
    - code_review
    - complete

---
# Approval with critique denied
name: approval_with_critique_denied
description: Workflow with critique and approval, where approval is denied.

inputs:
  steps: [research, plan, critique, approve, implement, code_review]

events:
  - node: research
    output:
      response_text: "Research done."

  - node: plan
    output:
      response_text: "Plan done."

  - node: criticize
    output:
      response_text: "Major issues found."

  - node: revise
    output:
      response_text: "Cannot address issues."

  - node: approve
    output:
      status: denied

expect:
  outcome: completed
  reached:
    - research
    - plan
    - criticize
    - revise
    - approve
  not_reached:
    - implement
    - code_review
    - complete

---
# State injection - start at code_review
name: state_injection_start_at_code_review
description: Start workflow at code_review with pre-populated state.

state:
  lint:
    exit_code: 0
  test:
    exit_code: 0
  build:
    exit_code: 0

start_at: code_review

inputs:
  steps: [implement, lint, test, build, code_review]

events:
  - node: code_review
    output:
      response:
        grade: pass
        summary: "All checks passed in prior steps."
        suggestions: []

expect:
  outcome: completed
  reached:
    - code_review
    - complete

---
# Lint fails - code review sees failure status
name: lint_fails_review_sees_status
description: Lint failure is properly reflected in code_review context.

inputs:
  steps: [plan, implement, lint, code_review]

events:
  - node: plan
    output:
      response_text: "Plan."

  - node: implement
    output:
      response_text: "Implementation."

  - node: lint
    output:
      exit_code: 1
      stdout: "Error: missing semicolon at line 42"

  - node: code_review
    output:
      response:
        grade: fail
        summary: "Lint check failed - code style issues found."
        suggestions:
          - "Fix the missing semicolon at line 42"
          - "Run linter locally before committing"

expect:
  outcome: completed
  reached:
    - plan
    - implement
    - lint
    - code_review
    - complete

---
# Build fails - code review sees failure
name: build_fails_review_sees_status
description: Build failure is properly reflected in code_review context.

inputs:
  steps: [plan, implement, build, code_review]

events:
  - node: plan
    output:
      response_text: "Plan."

  - node: implement
    output:
      response_text: "Implementation."

  - node: build
    output:
      exit_code: 1
      stdout: "Error: undefined reference to 'main'"

  - node: code_review
    output:
      response:
        grade: fail
        summary: "Build failed - compilation errors found."
        suggestions:
          - "Fix the undefined reference error"
          - "Ensure all dependencies are properly imported"

expect:
  outcome: completed
  reached:
    - plan
    - implement
    - build
    - code_review
    - complete

---
# TDD without test step - only writes tests
name: tdd_without_test_step
description: TDD enabled but test step not included - tests are written but not run.

inputs:
  steps: [plan, tdd, implement, code_review]

events:
  - node: plan
    output:
      response_text: "Plan with TDD."

  - node: write_tests
    output:
      response_text: "Tests written for planned functionality."

  - node: implement
    output:
      response_text: "Implementation to satisfy tests."

  - node: code_review
    output:
      response:
        grade: pass
        summary: "Tests written but not executed in workflow."
        suggestions:
          - "Consider enabling test step to run tests automatically"

expect:
  outcome: completed
  reached:
    - plan
    - write_tests
    - implement
    - code_review
    - complete

---
# Multiple checks fail
name: multiple_checks_fail
description: Both lint and test fail, code review sees both failures.

inputs:
  steps: [plan, implement, lint, test, code_review]

events:
  - node: plan
    output:
      response_text: "Plan."

  - node: implement
    output:
      response_text: "Implementation."

  - node: lint
    output:
      exit_code: 1
      stdout: "Lint errors found"

  - node: test
    output:
      exit_code: 1
      stdout: "3 tests failed"

  - node: code_review
    output:
      response:
        grade: fail
        summary: "Both lint and test checks failed."
        suggestions:
          - "Fix lint errors first"
          - "Then address failing tests"
          - "Consider running checks locally before committing"

expect:
  outcome: completed
  reached:
    - plan
    - implement
    - lint
    - test
    - code_review
    - complete
