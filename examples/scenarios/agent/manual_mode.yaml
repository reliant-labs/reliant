# Manual Mode: Approval required before tool execution
#
# Tests the manual approval flow:
# 1. LLM responds with tool calls
# 2. Approval node is triggered (instead of direct execution)
# 3. User approves
# 4. Tools execute
# 5. LLM responds without tools, loop exits
#
# This verifies the manual mode approval gate works.

name: manual_mode
description: In manual mode, tools require approval before execution

inputs:
  mode: "manual"

events:
  # Iteration 1: LLM calls a tool
  - node: agent_loop.call_llm
    type: llm_response
    text: "I need to run a command. Requesting approval..."
    tool_calls:
      - name: bash
        input:
          command: "rm -rf /tmp/test"

  # Approval is granted (approval node outputs status: approved)
  - node: agent_loop.approval
    type: tool_result
    tool: approval
    output:
      status: "approved"

  # Tool execution result
  - node: agent_loop.execute_tools
    type: tool_result
    tool: bash
    output:
      result: "removed /tmp/test"

  # Iteration 2: LLM responds without tools (exits loop)
  - node: agent_loop.call_llm
    type: llm_response
    text: "Done! I've cleaned up the test directory."

expect:
  outcome: completed
  reached:
    - agent_loop
    - agent_loop.call_llm
    - agent_loop.approval  # Approval should be reached in manual mode
    - agent_loop.execute_tools
  not_reached:
    - max_turns_notification
