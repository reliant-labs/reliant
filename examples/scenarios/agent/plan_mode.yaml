# Plan Mode: Read-only tools, planning system prompt
#
# Tests the plan mode configuration:
# 1. LLM is called with planning system prompt
# 2. LLM uses read-only tools (view, grep, etc.)
# 3. LLM responds with a plan, no more tools
#
# This verifies plan mode restricts to read-only tools.
# Note: The tool_filter is set at runtime, so this test verifies
# the workflow path works - actual tool restriction is tested elsewhere.

name: plan_mode
description: Plan mode uses read-only tools and planning prompt

inputs:
  mode: "plan"
  planning_prompt: "You are in planning mode. Use read-only tools only."

events:
  # LLM uses a read-only tool
  - node: agent_loop.call_llm
    type: llm_response
    text: "Let me analyze the codebase structure..."
    tool_calls:
      - name: view
        input:
          file_path: "/project/src/main.go"

  # Tool result
  - node: agent_loop.execute_tools
    type: tool_result
    tool: view
    output:
      result: "package main\n\nfunc main() {\n\tfmt.Println(\"Hello\")\n}"

  # LLM responds with a plan (no tools)
  - node: agent_loop.call_llm
    type: llm_response
    text: |
      Based on my analysis, here's the implementation plan:
      1. Add error handling to main.go
      2. Create a config package
      3. Add tests
      
      Switch to Auto or Manual mode to execute this plan.

expect:
  outcome: completed
  reached:
    - agent_loop
    - agent_loop.call_llm
    - agent_loop.execute_tools
  not_reached:
    # Plan mode doesn't need approval (still uses auto execution)
    - agent_loop.approval
    - max_turns_notification
