# Tool Use: LLM calls tools, then responds
#
# Tests the tool execution path:
# 1. LLM responds with tool calls
# 2. Tools execute (auto-approved since mode defaults to 'auto')
# 3. LLM is called again
# 4. LLM responds without tools, loop exits
#
# This verifies tool execution and loop continuation work correctly.

name: tool_use
description: LLM calls tools, they execute, then LLM responds without tools

inputs:
  mode: "auto"  # Explicit auto mode for clarity

events:
  # Iteration 1: LLM calls a tool
  - node: agent_loop.call_llm
    type: llm_response
    text: "Let me check something for you."
    tool_calls:
      - name: bash
        input:
          command: "ls -la"

  # Tool execution result
  - node: agent_loop.execute_tools
    type: tool_result
    tool: bash
    output:
      result: "total 64\ndrwxr-xr-x  5 user  staff  160 Jan 24 10:00 .\n-rw-r--r--  1 user  staff  1234 Jan 24 10:00 file.txt"

  # Iteration 2: LLM responds without tools (exits loop)
  - node: agent_loop.call_llm
    type: llm_response
    text: "I found file.txt in the current directory. Is there anything else you'd like me to help with?"

expect:
  outcome: completed
  reached:
    - agent_loop
    - agent_loop.call_llm
    - agent_loop.execute_tools
  not_reached:
    # No manual approval in auto mode
    - agent_loop.approval
    # Max turns notification shouldn't appear
    - max_turns_notification
