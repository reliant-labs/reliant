# Manual mode with approval denied
name: manual_mode_denied
description: Manual mode, user denies approval, loop continues without executing tools
inputs:
  mode: manual
  max_turns: 100
  response_tool_name: submit_response
events:
  # LLM requests a risky tool
  - node: agent_loop.call_llm
    output:
      message:
        role: assistant
        text: "I'm going to delete the file."
      response_text: "I'm going to delete the file."
      tool_calls:
        - id: call_0
          name: bash
          input:
            command: "rm -rf /important"
  # Approval is denied
  - node: agent_loop.approval
    output:
      approval_id: "approval_1"
      status: denied
      action_taken: deny
      data: {}
  # Loop continues (denied means no tool execution, but loop still iterates)
  # LLM tries again with response tool
  - node: agent_loop.call_llm
    output:
      message:
        role: assistant
        text: "I'll submit my response instead."
      response_text: "I'll submit my response instead."
      tool_calls:
        - id: call_1
          name: submit_response
          input:
            choice: complete
            value: "Task completed without file deletion as requested."
  # Approval granted for response tool
  - node: agent_loop.approval
    output:
      approval_id: "approval_2"
      status: approved
      action_taken: approve
      data: {}
  - node: agent_loop.execute_tools
    output:
      message:
        role: tool
        text: ""
      tool_results:
        - tool_call_id: call_1
          content: '{"choice": "complete"}'
      response_data:
        submit_response:
          choice: complete
          value: "Task completed without file deletion as requested."
      thread_token_count: 500
expect:
  outcome: completed
  reached:
    - agent_loop
    - agent_loop.call_llm
    - agent_loop.approval
    - agent_loop.execute_tools
  not_reached:
    - agent_loop.remind_response
